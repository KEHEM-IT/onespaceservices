<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Us - One Reach Services</title>
    <link rel="icon" type="image/x-icon" href="https://kehem.com/static/kehem.webp">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <!-- Swiper -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!-- Fontawesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- AOS -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

    <!-- Toastify CSS + JS CDN -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0048a7',
                        secondary: '#85ffff',
                        darkPrimary: '#00306e',
                        litePrimary: '#0063e4',
                    },
                    backdropBlur: {
                        xs: '2px',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'bounce-subtle': 'bounceSubtle 2s infinite',
                    }
                }
            }
        }
    </script>

    <script src="main.js"></script>
    <script src="search.js"></script>
</head>

<body>
    <!-- Main Content -->
    <main class="container mx-auto px-4 py-12">
        <div class="text-center mb-12" data-aos="fade-up">
            <h2 class="text-4xl font-bold text-gray-800 mb-4">Get In Touch</h2>
            <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                Ready to bring your vision to life? Contact us today and let's discuss your project requirements.
            </p>
        </div>

        <div class="max-w-7xl mx-auto">
            <form id="contactForm" class="bg-white rounded-2xl shadow-2xl overflow-hidden" data-aos="fade-up"
                data-aos-delay="200">
                <div class="grid lg:grid-cols-2 gap-0">
                    <!-- Left Column - Personal Information -->
                    <div class="bg-gradient-to-br from-primary to-darkPrimary text-white p-8 lg:p-12">
                        <div class="mb-8">
                            <h3 class="text-2xl font-bold mb-2">Personal Information</h3>
                            <p class="text-blue-200">Tell us about yourself</p>
                        </div>

                        <!-- User Data Display (when userData exists) -->
                        <div id="userDataDisplay" class="hidden space-y-6">
                            <div class="text-center mb-8">
                                <img id="userProfileImage" src="" alt="Profile"
                                    class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-white shadow-lg">
                                <h4 id="userName" class="text-xl font-semibold"></h4>
                            </div>

                            <div class="space-y-4">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-envelope w-5"></i>
                                    <span id="userEmail"></span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-phone w-5"></i>
                                    <span id="userPhone"></span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-birthday-cake w-5"></i>
                                    <span id="userDate"></span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-map-marker-alt w-5"></i>
                                    <span id="userLocation"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Personal Information Form -->
                        <div id="personalInfoForm" class="space-y-6">
                            <div>
                                <label for="fullName" class="block text-sm font-medium mb-2">
                                    Full Name <span class="text-red-300">*</span>
                                </label>
                                <input type="text" id="fullName" name="name" required
                                    class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent backdrop-blur-sm">
                            </div>

                            <div>
                                <label for="email" class="block text-sm font-medium mb-2">
                                    Email <span class="text-red-300">*</span>
                                </label>
                                <input type="email" id="email" name="email" required
                                    class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent backdrop-blur-sm">
                            </div>

                            <div>
                                <label for="phone" class="block text-sm font-medium mb-2">
                                    Phone <span class="text-red-300">*</span>
                                </label>
                                <input type="tel" id="phone" name="phone" required
                                    class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent backdrop-blur-sm">
                            </div>

                            <div>
                                <label for="dateOfBirth" class="block text-sm font-medium mb-2">
                                    Date of Birth <span class="text-red-300">*</span>
                                </label>
                                <input type="date" id="dateOfBirth" name="date" required
                                    class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent backdrop-blur-sm">
                            </div>

                            <div>
                                <label for="division" class="block text-sm font-medium mb-2">
                                    Division <span class="text-red-300">*</span>
                                </label>
                                <select id="division" name="division" required
                                    class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent backdrop-blur-sm">
                                    <option value="" class="text-gray-800">Select Division</option>
                                    <option value="Barishal" class="text-gray-800">Barishal</option>
                                    <option value="Chattogram" class="text-gray-800">Chattogram</option>
                                    <option value="Dhaka" class="text-gray-800">Dhaka</option>
                                    <option value="Khulna" class="text-gray-800">Khulna</option>
                                    <option value="Mymensingh" class="text-gray-800">Mymensingh</option>
                                    <option value="Rajshahi" class="text-gray-800">Rajshahi</option>
                                    <option value="Rangpur" class="text-gray-800">Rangpur</option>
                                    <option value="Sylhet" class="text-gray-800">Sylhet</option>
                                </select>
                            </div>

                            <div>
                                <label for="district" class="block text-sm font-medium mb-2">
                                    District <span class="text-red-300">*</span>
                                </label>
                                <select id="district" name="district" required
                                    class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent backdrop-blur-sm">
                                    <option value="" class="text-gray-800">Select District</option>
                                </select>
                            </div>

                            <div>
                                <label for="area" class="block text-sm font-medium mb-2">
                                    Area <span class="text-red-300">*</span>
                                </label>
                                <input type="text" id="area" name="area" required
                                    class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent backdrop-blur-sm"
                                    placeholder="Enter your area">
                            </div>

                            <div>
                                <label for="profile" class="block text-sm font-medium mb-2">
                                    Profile Picture <span class="text-red-300">*</span>
                                </label>
                                <input type="file" id="profile" name="profile" accept="image/*" required
                                    class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-white file:text-primary file:font-medium hover:file:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent backdrop-blur-sm">
                            </div>
                        </div>

                        <!-- Hidden user_id field for existing users -->
                        <input type="hidden" id="userId" name="user_id" value="">
                    </div>

                    <!-- Right Column - Contact Details -->
                    <div class="p-8 lg:p-12">
                        <div class="mb-8">
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">Contact Details</h3>
                            <p class="text-gray-600">How can we help you?</p>
                        </div>

                        <div class="space-y-6">
                            <div>
                                <label for="serviceInterest" class="block text-sm font-medium text-gray-700 mb-2">
                                    Service Interest <span class="text-red-500">*</span>
                                </label>
                                <select id="serviceInterest" name="service_interest" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Select a service</option>
                                    <option value="architecture">Architectural Design</option>
                                    <option value="structure">Structural Design</option>
                                    <option value="electrical">Electrical Design</option>
                                    <option value="mechanical">Mechanical Design</option>
                                    <option value="plumbing">Plumbing & Water Services</option>
                                    <option value="interior">Interior Design & Implementation</option>
                                    <option value="landscape">Landscape Design</option>
                                    <option value="construction">Construction Services</option>
                                    <option value="renovation">Renovation & Repairing</option>
                                    <option value="propertym">Project Management & Consultancy</option>
                                    <option value="facility">Building Maintenance & Facility Management</option>
                                    <option value="realestate">Land Development & Real Estate Services</option>
                                </select>
                            </div>

                            <div>
                                <label for="message" class="block text-sm font-medium text-gray-700 mb-2">
                                    Message
                                </label>
                                <textarea id="message" name="message" rows="6"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent resize-none"
                                    placeholder="Tell us about your project requirements..."></textarea>
                            </div>

                            <div>
                                <label for="contactTime" class="block text-sm font-medium text-gray-700 mb-2">
                                    Preferred Contact Time
                                </label>
                                <select id="contactTime" name="contact_time"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Select preferred time</option>
                                    <option value="Morning (9 AM - 12 PM)">Morning (9 AM - 12 PM)</option>
                                    <option value="Afternoon (12 PM - 5 PM)">Afternoon (12 PM - 5 PM)</option>
                                    <option value="Evening (5 PM - 8 PM)">Evening (5 PM - 8 PM)</option>
                                    <option value="Anytime">Anytime</option>
                                </select>
                            </div>

                            <button type="submit"
                                class="w-full bg-gradient-to-r from-primary to-litePrimary text-white py-4 px-8 rounded-lg font-semibold text-lg hover:from-darkPrimary hover:to-primary transform hover:scale-[1.02] transition-all duration-200 shadow-lg">
                                <i class="fas fa-paper-plane mr-2"></i>
                                Send Message
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </main>

    <script>
        // Districts data organized by division
        const districts = {
            "Barishal": ["Barishal", "Barguna", "Bhola", "Jhalokathi", "Patuakhali", "Pirojpur"],
            "Chattogram": ["Bandarban", "Brahmanbaria", "Chandpur", "Chattogram", "Cumilla", "Cox's Bazar", "Feni", "Khagrachari", "Lakshmipur", "Noakhali", "Rangamati"],
            "Dhaka": ["Dhaka", "Faridpur", "Gazipur", "Gopalganj", "Kishoreganj", "Madaripur", "Manikganj", "Munshiganj", "Narayanganj", "Narsingdi", "Rajbari", "Shariatpur", "Tangail"],
            "Khulna": ["Bagerhat", "Chuadanga", "Jessore", "Jhenaidah", "Khulna", "Kushtia", "Magura", "Meherpur", "Narail", "Satkhira"],
            "Mymensingh": ["Jamalpur", "Mymensingh", "Netrokona", "Sherpur"],
            "Rajshahi": ["Bogura", "Joypurhat", "Naogaon", "Natore", "Chapainawabganj", "Pabna", "Rajshahi", "Sirajganj"],
            "Rangpur": ["Dinajpur", "Gaibandha", "Kurigram", "Lalmonirhat", "Nilphamari", "Panchagarh", "Rangpur", "Thakurgaon"],
            "Sylhet": ["Habiganj", "Moulvibazar", "Sunamganj", "Sylhet"]
        };

        // DOM elements
        const personalInfoForm = document.getElementById('personalInfoForm');
        const userDataDisplay = document.getElementById('userDataDisplay');
        const divisionSelect = document.getElementById('division');
        const districtSelect = document.getElementById('district');
        const contactForm = document.getElementById('contactForm');
        const userIdField = document.getElementById('userId');

        // Initialize AOS
        AOS.init({
            duration: 1000,
            once: true
        });

        // Check for existing user data on page load
        document.addEventListener('DOMContentLoaded', function () {
            checkUserData();
            handleURLParams();

            // Division change handler
            divisionSelect.addEventListener('change', function () {
                updateDistricts(this.value);
            });

            // Form submit handler
            contactForm.addEventListener('submit', handleFormSubmit);
        });

        // Handle URL parameters for auto-selecting service
        function handleURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const serviceParam = urlParams.get('service') || window.location.pathname.split('?')[1];

            if (serviceParam) {
                const serviceSelect = document.getElementById('serviceInterest');
                // Check if the service parameter matches any option value
                const option = Array.from(serviceSelect.options).find(opt =>
                    opt.value === serviceParam || opt.value.includes(serviceParam)
                );
                if (option) {
                    serviceSelect.value = option.value;
                }
            }
        }

        function checkUserData() {
            const userData = JSON.parse(localStorage.getItem('userData') || 'null');
            if (userData) {
                displayUserData(userData);
                hidePersonalInfoForm();
                userIdField.value = userData.id;
            } else {
                showPersonalInfoForm();
                userIdField.value = '';
            }
        }

        function displayUserData(userData) {
            document.getElementById('userName').textContent = userData.name;
            document.getElementById('userEmail').textContent = userData.email;
            document.getElementById('userPhone').textContent = userData.phone;
            document.getElementById('userDate').textContent = new Date(userData.date).toLocaleDateString();
            document.getElementById('userLocation').textContent = `${userData.area}, ${userData.district}, ${userData.division}`;

            // Handle profile image display
            if (userData.profile) {
                document.getElementById('userProfileImage').src = userData.profile;
            }

            userDataDisplay.classList.remove('hidden');
        }

        function hidePersonalInfoForm() {
            personalInfoForm.classList.add('hidden');
            // Remove required attributes from hidden fields to prevent validation errors
            const requiredFields = personalInfoForm.querySelectorAll('[required]');
            requiredFields.forEach(field => {
                field.removeAttribute('required');
                field.setAttribute('data-was-required', 'true');
            });
        }

        function showPersonalInfoForm() {
            personalInfoForm.classList.remove('hidden');
            userDataDisplay.classList.add('hidden');
            userIdField.value = '';

            // Restore required attributes when showing the form
            const wasRequiredFields = personalInfoForm.querySelectorAll('[data-was-required]');
            wasRequiredFields.forEach(field => {
                field.setAttribute('required', 'true');
                field.removeAttribute('data-was-required');
            });
        }

        function updateDistricts(selectedDivision) {
            const districtOptions = districts[selectedDivision] || [];
            districtSelect.innerHTML = '<option value="" class="text-gray-800">Select District</option>';

            districtOptions.forEach(district => {
                const option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                option.className = 'text-gray-800';
                districtSelect.appendChild(option);
            });
        }

        async function handleFormSubmit(e) {
            e.preventDefault();

            // Validate only visible required fields
            const visibleRequiredFields = Array.from(contactForm.querySelectorAll('[required]'))
                .filter(field => {
                    const rect = field.getBoundingClientRect();
                    return rect.width > 0 && rect.height > 0;
                });

            let isValid = true;
            for (let field of visibleRequiredFields) {
                if (!field.value.trim()) {
                    field.focus();
                    isValid = false;
                    break;
                }
            }

            if (!isValid) {
                Toastify({
                    text: "Please fill in all required fields.",
                    duration: 3000,
                    gravity: "top",
                    position: "right",
                    style: {
                        background: "linear-gradient(to right, #ff5f6d, #ffc371)",
                    }
                }).showToast();
                return;
            }

            const formData = new FormData();

            // Add user_id if exists
            if (userIdField.value) {
                formData.append('user_id', userIdField.value);
            } else {
                // Add personal info only for new users
                formData.append('name', document.getElementById('fullName').value);
                formData.append('email', document.getElementById('email').value);
                formData.append('phone', document.getElementById('phone').value);
                formData.append('date', document.getElementById('dateOfBirth').value);
                formData.append('division', document.getElementById('division').value);
                formData.append('district', document.getElementById('district').value);
                formData.append('area', document.getElementById('area').value);

                const profileFile = document.getElementById('profile').files[0];
                if (profileFile) {
                    formData.append('profile', profileFile);
                }
            }

            // Always add contact details
            formData.append('service_interest', document.getElementById('serviceInterest').value);
            formData.append('message', document.getElementById('message').value);
            formData.append('contact_time', document.getElementById('contactTime').value);

            // Show loading toast
            Toastify({
                text: "Sending your message...",
                duration: 2000,
                gravity: "bottom",
                position: "center",
                style: {
                    background: "linear-gradient(to right, #0048a7, #0063e4)",
                }
            }).showToast();

            try {
                const response = await fetch('https://onereachservices.com/contact_form', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.text();

                if (response.ok) {
                    // Success toast
                    Toastify({
                        text: "Message sent successfully! We'll get back to you soon.",
                        duration: 4000,
                        gravity: "top",
                        position: "right",
                        style: {
                            background: "linear-gradient(to right, #00b09b, #96c93d)",
                        }
                    }).showToast();

                    // Save new user data only for first-time users
                    if (!userIdField.value) {
                        const userData = {
                            id: Date.now(),
                            name: document.getElementById('fullName').value,
                            email: document.getElementById('email').value,
                            phone: document.getElementById('phone').value,
                            date: document.getElementById('dateOfBirth').value,
                            division: document.getElementById('division').value,
                            district: document.getElementById('district').value,
                            area: document.getElementById('area').value,
                            profile: document.getElementById('profile').files[0] ? URL.createObjectURL(document.getElementById('profile').files[0]) : null
                        };
                        localStorage.setItem('userData', JSON.stringify(userData));
                        checkUserData();
                    }

                    // Reset only contact details
                    document.getElementById('serviceInterest').value = '';
                    document.getElementById('message').value = '';
                    document.getElementById('contactTime').value = '';

                    // Redirect to referrer page after 2 seconds
                    setTimeout(() => {
                        const referrer = document.referrer;
                        if (referrer && referrer !== window.location.href) {
                            window.location.href = referrer;
                        } else {
                            // Fallback to home page if no referrer
                            window.location.href = '/';
                        }
                    }, 2000);

                } else {
                    throw new Error('Failed to send message');
                }
            } catch (error) {
                console.error('Error:', error);
                Toastify({
                    text: "Failed to send message. Please try again.",
                    duration: 4000,
                    gravity: "top",
                    position: "right",
                    style: {
                        background: "linear-gradient(to right, #ff5f6d, #ffc371)",
                    }
                }).showToast();
            }
        }
    </script>
</body>

</html>

</body>

</html>